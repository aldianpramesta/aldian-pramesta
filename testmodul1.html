<!DOCTYPE html>
<html>
<head>
  <title>Modul A</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body>
  <h1>Selamat datang di Modul A</h1>
  <p>Ini adalah konten eksklusif untuk pembeli produk A.</p>

  <script>
    // Firebase setup
    const firebaseConfig = {
      apiKey: "AIzaSyDAjJ-_jTNh7HucY66o1A6PZh-ohrpETVY",
      authDomain: "temter-df972.firebaseapp.com",
      projectId: "temter-df972",
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const akses = {
      // Kosongin untuk test
      //"aldianpramesta@gmail.com": {
      //  produk: ["produkA"],
      //  expiredAt: "2025-05-10"
      //},
      "email2@gmail.com": {
        produk: ["produkB"],
        expiredAt: "2025-06-01"
      }
    };

    function isStillActive(expiredAt) {
      const today = new Date().toISOString().split("T")[0];
      return expiredAt >= today;
    }

    function checkAccess(produkYangDiminta) {
      console.log("Menunggu user login...");
      const unsubscribe = auth.onAuthStateChanged((user) => {
        if (!user) {
          alert("Silakan login terlebih dahulu.");
          window.location.href = "index.html";
          return;
        }

        const email = user.email;
        const userData = akses[email];
        console.log("Login sebagai:", email);

        if (
          userData &&
          userData.produk.includes(produkYangDiminta) &&
          isStillActive(userData.expiredAt)
        ) {
          console.log("✅ Akses diberikan.");
        } else {
          console.log("❌ Akses ditolak.");
          alert("Akses kamu tidak valid untuk produk ini.");
          window.location.href = "no-access.html";
        }

        unsubscribe(); // stop listening
      });
    }

    // Tunggu sampai halaman benar-benar siap
    window.addEventListener("load", function() {
      checkAccess("produkA");
    });
  </script>
</body>
</html>
